"use strict";(self.webpackChunkattendance_app=self.webpackChunkattendance_app||[]).push([[277],{4277:(e,a,t)=>{t.r(a),t.d(a,{default:()=>c});var r=t(8),s=t(5043),d=t(2253),n=t(5472),i=t(238),o=t(3252),l=t(579);function c(){const[e,a]=(0,s.useState)((()=>{const e=(0,i.A)(new Date,{weekStartsOn:0});return(0,o.A)(e,"yyyy-MM-dd")})),[t,c]=(0,s.useState)(""),[u,m]=(0,s.useState)([]),[x,y]=(0,s.useState)(""),[p,g]=(0,s.useState)(""),[h,b]=(0,s.useState)(""),[f,v]=(0,s.useState)(!1),[w,k]=(0,s.useState)("");function j(e){b(e),setTimeout((()=>b("")),2e3)}(0,s.useEffect)((()=>{const e=(0,n.P)((0,n.rJ)(d.db,"cashEntriesHistory"),(0,n.My)("date","desc")),a=(0,n.aQ)(e,(e=>{const a=e.docs.map((e=>(0,r.A)({id:e.id},e.data())));m(a)}));return()=>a()}),[]),(0,s.useEffect)((()=>{const a=(0,n.H9)(d.db,"cashEntries",e);(0,n.x7)(a).then((e=>{e.exists()?c(e.data().amount.toString()):c("")}))}),[e]);return(0,l.jsxs)("div",{className:"max-w-lg mx-auto space-y-6",children:[(0,l.jsx)("h2",{className:"text-xl font-semibold dark:text-gray-100",children:"Lan\xe7ar Caixa Semanal"}),h&&(0,l.jsx)("div",{className:"px-4 py-2 bg-green-100 text-green-800 rounded shadow text-center transition",children:h}),w&&(0,l.jsx)("div",{className:"px-4 py-2 bg-red-100 text-red-800 rounded shadow text-center transition",children:w}),(0,l.jsxs)("form",{onSubmit:async a=>{a.preventDefault(),k(""),v(!0);const r=parseFloat(t.replace(",","."));if(isNaN(r)||r<=0)return k("Digite um valor v\xe1lido e maior que zero."),void v(!1);try{const a=(0,n.H9)(d.db,"cashEntries",e),t=await(0,n.x7)(a);let s=0;t.exists()&&(s=t.data().amount||0);const i=s+r;await(0,n.BN)(a,{date:e,amount:i,createdAt:new Date}),await(0,n.gS)((0,n.rJ)(d.db,"cashEntriesHistory"),{type:"entrada",date:e,amount:r,reason:"Lan\xe7amento de entrada",createdAt:new Date}),j("Entrada salva com sucesso!")}catch(s){k("Erro ao salvar entrada.")}v(!1)},className:"flex flex-col space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block mb-1 dark:text-gray-300",children:"Domingo da Semana"}),(0,l.jsx)("input",{type:"date",value:e,onChange:e=>a(e.target.value),className:"w-full px-3 py-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200",required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block mb-1 dark:text-gray-300",children:"Valor (R$)"}),(0,l.jsx)("input",{type:"number",min:"0.01",step:"0.01",value:t,onChange:e=>c(e.target.value),placeholder:"0.00",className:"w-full px-3 py-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200",required:!0})]}),(0,l.jsx)("button",{type:"submit",className:"self-end px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition",disabled:f,children:f?"Salvando...":"Salvar Entrada"})]}),(0,l.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),k(""),v(!0);const a=parseFloat(x.replace(",","."));if(isNaN(a)||a<=0)return k("Digite um valor v\xe1lido e maior que zero para retirada."),void v(!1);if(!p.trim())return k("Informe o motivo da retirada."),void v(!1);if(window.confirm("Confirma registrar retirada de R$ ".concat(a.toFixed(2),"?"))){try{await(0,n.gS)((0,n.rJ)(d.db,"cashEntriesHistory"),{type:"retirada",date:(0,o.A)(new Date,"yyyy-MM-dd"),amount:a,reason:p,createdAt:new Date}),y(""),g(""),j("Retirada registrada!")}catch(t){k("Erro ao registrar retirada.")}v(!1)}else v(!1)},className:"flex flex-col space-y-4 border-t pt-6 mt-6",children:[(0,l.jsx)("h3",{className:"font-medium dark:text-gray-100",children:"Registrar Retirada"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block mb-1 dark:text-gray-300",children:"Valor da Retirada (R$)"}),(0,l.jsx)("input",{type:"number",min:"0.01",step:"0.01",value:x,onChange:e=>y(e.target.value),placeholder:"0.00",className:"w-full px-3 py-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200",required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block mb-1 dark:text-gray-300",children:"Motivo da Retirada"}),(0,l.jsx)("input",{type:"text",value:p,onChange:e=>g(e.target.value),placeholder:"Ex: Compra de material",className:"w-full px-3 py-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200",required:!0})]}),(0,l.jsx)("button",{type:"submit",className:"self-end px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition",disabled:f,children:f?"Registrando...":"Registrar Retirada"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"font-medium dark:text-gray-100",children:"Hist\xf3rico"}),(0,l.jsx)("ul",{className:"mt-2 space-y-1",children:u.map((e=>{var a;const t=null!==(a=e.createdAt)&&void 0!==a&&a.toDate?e.createdAt.toDate():new Date(e.createdAt),r=Date.now()-t.getTime()<3e5;return(0,l.jsxs)("li",{className:"flex justify-between items-center",children:[(0,l.jsxs)("span",{className:"dark:text-gray-200",children:[e.date," - ","retirada"===e.type?"Retirada":"Entrada",e.reason?" (".concat(e.reason,")"):""]}),(0,l.jsxs)("span",{className:"retirada"===e.type?"text-red-600":"text-green-600",children:["R$ ",e.amount.toFixed(2)]}),r&&(0,l.jsx)("button",{className:"ml-2 px-2 py-1 text-xs bg-red-500 text-white rounded",onClick:()=>(async e=>{var a;const t=null!==(a=e.createdAt)&&void 0!==a&&a.toDate?e.createdAt.toDate():new Date(e.createdAt);if(!(Date.now()-t.getTime()<3e5))return void j("S\xf3 \xe9 poss\xedvel excluir lan\xe7amentos feitos nos \xfaltimos 5 minutos.");if(window.confirm("Tem certeza que deseja excluir este lan\xe7amento?"))try{if("entrada"===e.type){const a=(0,n.H9)(d.db,"cashEntries",e.date),t=await(0,n.x7)(a);if(t.exists()){let r=(t.data().amount||0)-e.amount;r<=0?await(0,n.kd)(a):await(0,n.BN)(a,{date:e.date,amount:r,createdAt:t.data().createdAt||new Date})}}await(0,n.kd)((0,n.H9)(d.db,"cashEntriesHistory",e.id)),j("Lan\xe7amento exclu\xeddo!")}catch(r){k("Erro ao excluir lan\xe7amento.")}})(e),children:"Excluir"})]},e.id)}))})]})]})}}}]);
//# sourceMappingURL=277.f36c24d9.chunk.js.map