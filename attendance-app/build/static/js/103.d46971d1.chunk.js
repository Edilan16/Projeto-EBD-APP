"use strict";(self.webpackChunkattendance_app=self.webpackChunkattendance_app||[]).push([[103],{103:(e,t,a)=>{a.r(t),a.d(t,{default:()=>f});var r=a(5043),n=a(2253),s=a(5472),d=a(3252),o=a(2128),l=a(8920),c=a(9519),i=a(238),x=a(108),h=a(5392),m=a(2185),u=a(6026),p=a(6150),y=a(1327),j=a(2798),b=a(579);function f(){const[e,t]=(0,r.useState)([]),[a,f]=(0,r.useState)([]),[v,g]=(0,r.useState)(""),[R,N]=(0,r.useState)("all"),[M,w]=(0,r.useState)(""),[E,S]=(0,r.useState)(""),[F,A]=(0,r.useState)(""),[C,k]=(0,r.useState)("all"),[$,L]=(0,r.useState)(!0);(0,r.useEffect)((()=>{L(!0),Promise.all([(0,s.GG)((0,s.rJ)(n.db,"cashEntries")),(0,s.GG)((0,s.rJ)(n.db,"cashEntriesHistory"))]).then((e=>{let[a,r]=e;t(a.docs.map((e=>{var t;const a=e.data();return a.date=null!==(t=a.date)&&void 0!==t&&t.toDate?a.date.toDate():new Date(a.date),a.type="entrada",a}))),f(r.docs.map((e=>{var t;const a=e.data();return a.date=null!==(t=a.date)&&void 0!==t&&t.toDate?a.date.toDate():new Date(a.date),a}))),L(!1)}))}),[]);const D=(0,r.useMemo)((()=>{const t=new Set;return e.forEach((e=>{t.add((0,d.A)((0,o.A)(e.date),"yyyy-MM"))})),[...t].sort()}),[e]),O=(0,r.useMemo)((()=>{const t=new Set;return e.forEach((e=>{t.add(e.date.getFullYear())})),[...t].sort()}),[e]),U=(0,r.useMemo)((()=>[...e,...a.filter((e=>"retirada"===e.type))]),[e,a]),T=(0,r.useMemo)((()=>{let e=U;if("month"===R&&M&&(e=e.filter((e=>(0,d.A)((0,o.A)(e.date),"yyyy-MM")===M))),"year"===R&&M&&(e=e.filter((e=>e.date.getFullYear().toString()===M))),E&&F){const t=(0,l.A)(E),a=(0,l.A)(F);e=e.filter((e=>(0,c.A)(e.date,{start:t,end:a})))}return"all"!==C&&(e=e.filter((e=>(e.type||"entrada")===C))),v.trim()&&(e=e.filter((e=>(e.reason||"").toLowerCase().includes(v.toLowerCase())))),e.sort(((e,t)=>t.date-e.date))}),[U,R,M,E,F,C,v]),{total:G,byWeek:B,byMonth:P}=(0,r.useMemo)((()=>{let e=0;const t={},a={};return T.forEach((r=>{if("entrada"===(r.type||"entrada")){e+=r.amount;const n=(0,d.A)((0,i.A)(r.date),"yyyy-MM-dd"),s=(0,d.A)((0,o.A)(r.date),"yyyy-MM");t[n]=(t[n]||0)+r.amount,a[s]=(a[s]||0)+r.amount}})),{total:e,byWeek:t,byMonth:a}}),[T]),K=(0,r.useMemo)((()=>T.filter((e=>"retirada"===(e.type||"entrada"))).reduce(((e,t)=>e+(t.amount||0)),0)),[T]),V=G-K;const W=(0,r.useMemo)((()=>{const e={};return T.forEach((t=>{const a=(0,d.A)((0,o.A)(t.date),"yyyy-MM");e[a]||(e[a]={month:a,entradas:0,retiradas:0}),"entrada"===(t.type||"entrada")?e[a].entradas+=t.amount:e[a].retiradas+=t.amount})),Object.values(e).sort(((e,t)=>e.month.localeCompare(t.month)))}),[T]);return $?(0,b.jsx)("div",{children:"Carregando..."}):(0,b.jsxs)("div",{className:"max-w-xl mx-auto bg-white dark:bg-gray-800 p-6 rounded shadow",children:[(0,b.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"Relat\xf3rio Financeiro"}),(0,b.jsxs)("div",{className:"mb-4 flex flex-wrap gap-4 items-center",children:[(0,b.jsxs)("span",{children:[(0,b.jsx)("b",{children:"Saldo total:"})," ",(0,b.jsxs)("span",{className:V<0?"text-red-600":"text-green-700",children:["R$ ",V.toFixed(2)]})]}),(0,b.jsxs)("span",{children:[(0,b.jsx)("b",{children:"Total de entradas:"})," R$ ",G.toFixed(2)]}),(0,b.jsxs)("span",{children:[(0,b.jsx)("b",{children:"Total de retiradas:"})," R$ ",K.toFixed(2)]})]}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-2 items-center mb-4",children:[(0,b.jsxs)("label",{children:["Per\xedodo:",(0,b.jsxs)("select",{value:R,onChange:e=>{N(e.target.value),w("")},className:"ml-2",children:[(0,b.jsx)("option",{value:"all",children:"Todos"}),(0,b.jsx)("option",{value:"month",children:"Por m\xeas"}),(0,b.jsx)("option",{value:"year",children:"Por ano"})]})]}),"month"===R&&(0,b.jsxs)("select",{value:M,onChange:e=>w(e.target.value),children:[(0,b.jsx)("option",{value:"",children:"Selecione m\xeas"}),D.map((e=>(0,b.jsx)("option",{value:e,children:e},e)))]}),"year"===R&&(0,b.jsxs)("select",{value:M,onChange:e=>w(e.target.value),children:[(0,b.jsx)("option",{value:"",children:"Selecione ano"}),O.map((e=>(0,b.jsx)("option",{value:e,children:e},e)))]}),(0,b.jsx)("input",{type:"date",value:E,onChange:e=>S(e.target.value),className:"border rounded px-2 py-1",placeholder:"Data in\xedcio"}),(0,b.jsx)("input",{type:"date",value:F,onChange:e=>A(e.target.value),className:"border rounded px-2 py-1",placeholder:"Data fim"}),(0,b.jsxs)("select",{value:C,onChange:e=>k(e.target.value),className:"border rounded px-2 py-1",children:[(0,b.jsx)("option",{value:"all",children:"Entradas e Retiradas"}),(0,b.jsx)("option",{value:"entrada",children:"Somente Entradas"}),(0,b.jsx)("option",{value:"retirada",children:"Somente Retiradas"})]}),(0,b.jsx)("input",{type:"text",placeholder:"Buscar motivo...",value:v,onChange:e=>g(e.target.value),className:"border rounded px-2 py-1 ml-2"}),(0,b.jsx)("button",{onClick:function(){const e=[["Tipo","Data","Valor","Motivo"],...T.map((e=>["retirada"===e.type?"Retirada":"Entrada",(0,d.A)(e.date,"yyyy-MM-dd"),e.amount.toFixed(2),e.reason||""]))].map((e=>e.map((e=>'"'.concat((e||"").replace(/"/g,'""'),'"'))).join(";"))).join("\n"),t=new Blob(["\ufeff"+e],{type:"text/csv;charset=utf-8"}),a=URL.createObjectURL(t),r=document.createElement("a");r.href=a,r.download="financeiro.csv",r.click(),URL.revokeObjectURL(a)},className:"px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700",disabled:!T.length,children:"Exportar CSV"}),(0,b.jsx)("button",{onClick:function(){const e=["Relat\xf3rio Financeiro","Saldo total: R$ ".concat(V.toFixed(2)),"(Entradas: R$ ".concat(G.toFixed(2)," - Retiradas: R$ ").concat(K.toFixed(2),")"),"","Entradas por m\xeas:",...Object.entries(P).map((e=>{let[t,a]=e;return"".concat(t,": R$ ").concat(a.toFixed(2))})),"","Entradas por semana:",...Object.entries(B).map((e=>{let[t,a]=e;return"".concat(t,": R$ ").concat(a.toFixed(2))})),"","Lan\xe7amentos detalhados:",...T.map((e=>"".concat((0,d.A)(e.date,"yyyy-MM-dd"),": ").concat("retirada"===e.type?"-":"","R$ ").concat(e.amount.toFixed(2)," - ").concat(e.reason||"")))].join("\n"),t=new Blob([e],{type:"text/plain"}),a=URL.createObjectURL(t),r=document.createElement("a");r.href=a,r.download="relatorio-financeiro.txt",r.click(),URL.revokeObjectURL(a)},className:"px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700",disabled:!T.length,children:"Baixar relat\xf3rio TXT"})]}),(0,b.jsx)("h3",{className:"font-semibold mt-4",children:"Gr\xe1fico de Entradas e Retiradas por m\xeas"}),(0,b.jsx)("div",{style:{width:"100%",height:220},children:(0,b.jsx)(x.u,{width:"100%",height:200,children:(0,b.jsxs)(h.E,{data:W,children:[(0,b.jsx)(m.W,{dataKey:"month"}),(0,b.jsx)(u.h,{}),(0,b.jsx)(p.m,{formatter:e=>"R$ ".concat(e.toFixed(2))}),(0,b.jsx)(y.s,{}),(0,b.jsx)(j.y,{dataKey:"entradas",fill:"#16a34a",name:"Entradas"}),(0,b.jsx)(j.y,{dataKey:"retiradas",fill:"#dc2626",name:"Retiradas"})]})})}),(0,b.jsx)("h3",{className:"font-semibold mt-4",children:"Entradas por m\xeas"}),(0,b.jsx)("ul",{children:Object.entries(P).map((e=>{let[t,a]=e;return(0,b.jsxs)("li",{children:[t,": ",(0,b.jsxs)("b",{children:["R$ ",a.toFixed(2)]})]},t)}))}),(0,b.jsx)("h3",{className:"font-semibold mt-4",children:"Entradas por semana"}),(0,b.jsx)("ul",{children:Object.entries(B).map((e=>{let[t,a]=e;return(0,b.jsxs)("li",{children:[t,": ",(0,b.jsxs)("b",{children:["R$ ",a.toFixed(2)]})]},t)}))}),(0,b.jsx)("h3",{className:"font-semibold mt-4",children:"Hist\xf3rico detalhado"}),(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"min-w-full bg-white rounded shadow overflow-hidden text-sm",children:[(0,b.jsx)("thead",{className:"bg-gray-100",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"px-2 py-1 text-left",children:"Tipo"}),(0,b.jsx)("th",{className:"px-2 py-1 text-left",children:"Data"}),(0,b.jsx)("th",{className:"px-2 py-1 text-right",children:"Valor"}),(0,b.jsx)("th",{className:"px-2 py-1 text-left",children:"Motivo"})]})}),(0,b.jsx)("tbody",{children:T.map(((e,t)=>(0,b.jsxs)("tr",{className:"border-b last:border-0",children:[(0,b.jsx)("td",{className:"px-2 py-1 ".concat("retirada"===e.type?"text-red-600":"text-green-700"),children:"retirada"===e.type?"Retirada":"Entrada"}),(0,b.jsx)("td",{className:"px-2 py-1",children:(0,d.A)(e.date,"yyyy-MM-dd")}),(0,b.jsxs)("td",{className:"px-2 py-1 text-right font-bold ".concat("retirada"===e.type?"text-red-600":"text-green-700"),children:["R$ ",e.amount.toFixed(2)]}),(0,b.jsx)("td",{className:"px-2 py-1",children:e.reason||"-"})]},t)))})]})})]})}}}]);
//# sourceMappingURL=103.d46971d1.chunk.js.map